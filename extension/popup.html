<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web Pentest Companion</title>
    <link rel="stylesheet" href="styles/tailwind.css" />
  </head>
  <body class="app-shell">
    <main class="popup-shell">
      <header class="popup-header">
        <div class="brand-lockup">
          <span class="brand-mark">VG</span>
          <div>
            <p class="text-xs uppercase tracking-wide text-slate-400">Vanguard Scanner</p>
            <h1 class="text-lg font-semibold text-white">Web Companion</h1>
            <p class="text-xs text-slate-400">Mirrors the cloud dashboard theme.</p>
          </div>
        </div>
        <div class="header-actions">
          <span class="cloud-pill">Cloud API â€¢ onrender</span>
          <button id="openOptions" class="btn btn-muted text-xs px-3 py-2">Options</button>
        </div>
      </header>

      <section id="authSection" class="step-card">
        <div class="step-heading">
          <span class="step-index">01</span>
          <div class="flex-1">
            <h2>Authenticate</h2>
            <p>Manage your credentials from the settings panel.</p>
          </div>
          <span id="authStatus" class="status-pill">Signed out</span>
        </div>
        <p id="authMessage" class="text-sm text-slate-400">
          Sign in or create an account from the settings page before launching scans.
        </p>
        <div class="flex gap-2">
          <button id="authSettingsBtn" class="btn btn-primary flex-1">Open Settings</button>
          <button id="logoutBtn" class="btn btn-danger hidden">Sign Out</button>
        </div>
      </section>

      <section id="scanSection" class="step-card opacity-50 pointer-events-none" data-auth-locked>
        <div class="step-heading">
          <span class="step-index">02</span>
          <div>
            <h2>Pick mode & launch Playwright</h2>
            <p>Exactly the same flow you trigger from the website.</p>
          </div>
        </div>
        <div class="scan-target">
          <p class="mono-label">Active tab</p>
          <p class="glow-title" id="currentUrl">Waiting for tab...</p>
          <p class="text-xs text-slate-400">Playwright captures the current experience, then the API replays it server-side.</p>
        </div>
        <form id="scanForm" class="form-grid">
          <div class="mode-grid" id="modeGrid">
            <label class="mode-chip">
              <input type="radio" name="mode" value="ultra-safe" />
              <strong>Ultra Safe</strong>
              <span>Headers & passive checks</span>
            </label>
            <label class="mode-chip">
              <input type="radio" name="mode" value="safe" />
              <strong>Safe</strong>
              <span>Balanced active testing</span>
            </label>
            <label class="mode-chip">
              <input type="radio" name="mode" value="standard" checked />
              <strong>Standard</strong>
              <span>Full coverage (default)</span>
            </label>
            <label class="mode-chip">
              <input type="radio" name="mode" value="aggressive" />
              <strong>Aggressive</strong>
              <span>Deep payload fuzzing</span>
            </label>
          </div>
          <label class="setting-toggle">
            <div>
              <p class="font-semibold">Playwright crawler</p>
              <small>Use JS rendering + authenticated flows</small>
            </div>
            <input type="checkbox" name="useJs" class="toggle" checked />
          </label>
          <button type="submit" class="btn btn-primary w-full">Launch scan for this site</button>
        </form>
        <div id="scanStatus" class="status-pill">Idle</div>
      </section>

      <section class="step-card" data-auth-locked>
        <div class="step-heading">
          <span class="step-index">03</span>
          <div>
            <h2>Results & history</h2>
            <p>Same severity tags and typography as the Vanguard console.</p>
          </div>
          <button id="refreshHistory" class="btn btn-muted text-xs">Refresh</button>
        </div>
        <ul id="historyList" class="history-list text-sm"></ul>
      </section>

      <section id="resultSection" class="step-card hidden" data-auth-locked>
        <div class="step-heading">
          <span class="step-index">04</span>
          <div>
            <h2>Latest result</h2>
            <p>Severity breakdown and quick export.</p>
          </div>
          <div class="flex gap-2">
            <div class="btn-group btn-group-sm view-toggle" role="group">
              <button type="button" class="btn btn-muted text-xs active" id="website-view-btn">Website View</button>
              <button type="button" class="btn btn-muted text-xs" id="summary-view-btn">Summary</button>
            </div>
            <button id="downloadReport" class="btn btn-muted text-xs">Download JSON</button>
          </div>
        </div>
        <div id="summaryView">
          <div id="resultSummary" class="result-panel text-sm"></div>
          <div>
            <h3 class="text-xs uppercase tracking-wide text-slate-400 mb-2">Severity mix</h3>
            <div id="severityBadges" class="flex flex-wrap gap-2"></div>
          </div>
        </div>
        <div id="websiteFindingsView" class="website-findings-wrapper"></div>
      </section>
    </main>

    <template id="historyItemTemplate">
      <li class="history-item">
        <div class="history-meta">
          <span class="font-semibold text-white text-sm truncate data-target"></span>
          <small class="text-slate-400 data-mode"></small>
        </div>
        <div class="history-actions text-right">
          <p class="status-pill text-xs data-status"></p>
          <button class="btn btn-muted text-xs data-view">View</button>
        </div>
      </li>
    </template>

    <script type="module" src="popup.js"></script>
  </body>
</html>
